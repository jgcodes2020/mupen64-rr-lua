# Copyright Header

Every non-library file must contain the following header:

```cpp
/*
 * Copyright (c) 2025, Mupen64 maintainers, contributors, and original authors (Hacktarux, ShadowPrince, linker).
 *
 * SPDX-License-Identifier: GPL-2.0-or-later
 */
```

# Compiling

You'll need:
- Visual Studio (for the compiler, CMake, Ninja and vcpkg)

## Windows/CMake
Create a `CMakeUserPresets.json` in the root folder with the following:
```json
{
  "version": 3,
  "configurePresets": [
    {
      "name": "default",
      "inherits": "vcpkg",
      "environment": {
        "VCPKG_ROOT": "C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\vcpkg"
      }
    }
  ]
}
```

You may adjust the path in `VCPKG_ROOT` if you have `vcpkg` installed in an alternate location, or if you have a newer version than VS2022 installed. From here, open the Visual Studio Developer PowerShell and run `cmake --preset default` and `cmake --build build`.

To create a 32-bit build, run CMake under the 32-bit Visual Studio Developer PowerShell instead.

# Commit Style

Merge commits to the `main` branch *must* adhere to [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/#specification). 

---

Non-merge commits to the `main` branch *shouldn't* use the Conventional Commits spec.

This is to avoid polluting the final release changelog with commits that, for example, only fix bugs generated by merging PRs.

The exception to this rule are commit types that [wouldn't be included in the changelog anyway](https://github.com/mupen64/mupen64-rr-lua/blob/master/cliff.toml#L63).

---

Commits made on other branches don't have to adhere to any specific commit style.

Example commits:

```
fix(VCR): fix crash when playing a movie while holding B
```

```
feat(ConfigDialog): add plugin config API
```

# Changelogs

Generate changelogs using [git-cliff](https://git-cliff.org/).

# Program Structure

Mupen64 is currently divided into two parts: its Core, and its Windows GUI.

## <img src="https://github.com/user-attachments/assets/fa3b86d8-6bcf-4b65-a575-4ea2930a516c" width="64" align="center"/> Core 

The core implements emulation functionality and defines an API which allows it to be driven externally.

## <img src="https://github.com/user-attachments/assets/28439517-0e7a-41d6-829d-c2bd2f065d14" width="64" align="center"/> Views.Win32

The Win32 implementation of a Mupen64 GUI.

# Reading and using Crashlogs

If you have a `mupen.dmp`, open it in WinDbg and run `!analyze-v`.

If you only have the stacktrace from `mupen.log`:

1. Identify the faulting address
2. Open x32dbg
3. Open the "Go to" dialog by pressing Ctrl + G
4. Navigate to `0x00400000` + `[Your Address]`

# Code Style

Code formatting must abide by the [.clang-format](https://github.com/mkdasher/mupen64-rr-lua-/blob/master/.clang-format) file provided in the repository root.
Failure to comply will fail the check-format workflow.

# Plugin Guidelines

- Give your plugin a descriptive name.
    1. The filename should be formatted as follows: `[Plugin Name]-[x86|x64]-[debug|release].dll`
        a. e.g.: `TASInput-x86-release.dll` 
    2. The friendly name should be formatted as follows: `[Plugin Name] [Version] [x86|x64] [Debug]`
        a. e.g.: `TASInput 2.0.0 x86`, `TASInput 2.0.0 x86 Debug`
- Do as little initialization work in `DllMain` as possible. Do it all in `RomOpen` and cache the results.
    1. Watch out for implicit COM initialization through DirectInput!
- Write persistent config to the registry, not the filesystem.
    1. Play fair, don't pollute the user's Mupen directory if possible.

# Pre-Merge and Release Checklist

Before merging a pull request into main or pushing out a release, verify that:

1. The code is formatted according to the .clang-format file
2. All tests pass
3. The code is architecturally sound
4. Unicode-containing filesystem paths are consumed correctly
5. The wiki has been updated with any relevant changes
6. The plugin API is backwards-compatible *(unless otherwise specified)*